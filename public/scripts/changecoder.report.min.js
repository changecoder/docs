!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t(require("ajax-hook")):"function"==typeof define&&define.amd?define(["ajax-hook"],t):(e="undefined"!=typeof globalThis?globalThis:e||self).WebReportSDK=t(e.ah)}(this,(function(e){"use strict";function t(e){if(e&&e.__esModule)return e;var t=Object.create(null);return e&&Object.keys(e).forEach((function(o){if("default"!==o){var n=Object.getOwnPropertyDescriptor(e,o);Object.defineProperty(t,o,n.get?n:{enumerable:!0,get:function(){return e[o]}})}})),t.default=e,Object.freeze(t)}var o=t(e);const n=(e,t)=>{"sendBeacon"in navigator?((e,t)=>{const o=new FormData;Object.keys(t).forEach((e=>{let n=t[e];"string"!=typeof n&&(n=JSON.stringify(n)),o.append(e,n)})),navigator.sendBeacon(e,t)})(e,t):((e,t)=>{const o=new Image,n=Object.keys(t).reduce(((e,o)=>[`${o}=${encodeURIComponent(t[o])}`].concat(e)),[]);o.src=`${e}?${n.join("&")}`})(e,t)},r=!!window.performance,s=e=>Object.assign({},{time:(new Date).getTime()},e),i=e=>{let t="",o=0,n=0,r=e.match(/\(.+?\)/);if(r&&r.length){let e=r[0];e=e.replace(/\w.+[js|html]/g,(e=>(t=e,"")));const s=e.split(":");try{n=parseInt(s[1]),o=parseInt(s[2])}catch(e){}}return{resourceUrl:t,col:o,line:n}};let a="unknow",c="unknow",d="unknow",g="unknow",u="unknow",w="unknow",p="unknow",m="unknow",f="unknow";const l=navigator.userAgent.toLowerCase(),h=e=>e.test(l),b=e=>l.match(e)?.toString().replace(/[^0-9|_.]/g,"").replace(/_/g,"."),x=e=>{const t=b(e);t&&(c=t)},k=e=>{const t=b(e);t&&(u=t)},y=e=>{const t=b(e);t&&(p=t)},T=e=>{const t=b(e);t&&(f=t)},j=h(/windows|win32|win64|wow32|wow64/g),_=h(/macintosh|macintel/g),v=h(/android|adr/g),E=h(/ios|iphone|ipad|ipod|iwatch/g);j?a="windows":_?a="macos":v?a="android":E&&(a="ios"),j?h(/windows nt 5.0|windows 2000/g)?c="2000":h(/windows nt 5.1|windows xp/g)?c="xp":h(/windows nt 5.2|windows 2003/g)?c="2003":h(/windows nt 6.0|windows vista/g)?c="vista":h(/windows nt 6.1|windows 7/g)?c="7":h(/windows nt 6.2|windows 8/g)?c="8":h(/windows nt 6.3|windows 8.1/g)?c="8.1":h(/windows nt 10.0|windows 10/g)&&(c="10"):_||v?x(/os x [\d._]+/g):E&&x(/os [\d._]+/g),j||_?d="desktop":(v||E||h(/mobile/g))&&(d="mobile"),h(/applewebkit/g)?(g="webkit",h(/edge/g)?w="edge":h(/opr/g)?w="opera":h(/chrome/g)?w="chrome":h(/safari/g)&&(w="safari")):h(/gecko/g)&&h(/firefox/g)?(g="gecko",w="firefox"):h(/presto/g)?(g="presto",w="opera"):h(/trident|compatible|msie/g)&&(g="trident",w="ie"),"webkit"===g?k(/applewebkit\/[\d._]+/g):"gecko"===g?k(/gecko\/[\d._]+/g):"presto"===g?k(/presto\/[\d._]+/g):"trident"===g&&k(/trident\/[\d._]+/g),"chrome"===w?y(/chrome\/[\d._]+/g):"safari"===w?y(/version\/[\d._]+/g):"firefox"===w?y(/firefox\/[\d._]+/g):"opera"===w?y(/opr\/[\d._]+/g):"iexplore"===w?y(/(msie [\d._]+)|(rv:[\d._]+)/g):"edge"===w&&y(/edge\/[\d._]+/g),h(/micromessenger/g)?(m="wechat",T(/micromessenger\/[\d._]+/g)):h(/qqbrowser/g)?(m="qq",T(/qqbrowser\/[\d._]+/g)):h(/ucbrowser/g)?(m="uc",T(/ucbrowser\/[\d._]+/g)):h(/qihu 360se/g)?m="360":h(/metasr/g)?m="sougou":h(/lbbrowser/g)?m="liebao":h(/maxthon/g)&&(m="maxthon",T(/maxthon\/[\d._]+/g));var S=Object.freeze({__proto__:null,get system(){return a},get systemVersion(){return c},get platform(){return d},get engine(){return g},get engineVersion(){return u},get browser(){return w},get browserVersion(){return p},get shell(){return m},get shellVersion(){return f},ua:l,isWindows:j,isMacos:_,isAndroid:v,isIos:E});const L={domain:"https://api.changecoder.com/v1/proxy/report",delay:1e3,isAjax:!0,filterUrl:[],isPage:!0,isError:!0};return class{opts;conf;constructor(e){this.opts=Object.assign({},L,e),this.initConf()}initConf(){this.conf={resourceList:[],performance:{},errorList:[],ajaxList:{},page:window.location.href}}sendReport(){const e=this.opts.domain,t=Object.assign({},S);n(e,t)}start(){const{isAjax:e}=this.opts;var t;e&&o.proxy({onRequest:(e,t)=>{const o=(n=e.url,`${Date.now()}-${n}`);var n;this.conf.ajaxList[o]={id:o,url:e.url,method:e.method,status:0,statusText:"",errorType:"",requestTime:Date.now(),responseTime:0},e.user=o,t.next(e)},onError:(e,t)=>{const o=e.config.user;Object.assign({},this.conf.ajaxList[o],{responseTime:Date.now(),errorType:e.type}),t.next(e)},onResponse:(e,t)=>{const o=e.config.user;Object.assign({},this.conf.ajaxList[o],{responseTime:Date.now(),status:e.status,statusText:e.statusText}),t.next(e)}}),this.opts.isPage&&window.requestAnimationFrame((()=>{const e=(()=>{const e=r&&window.performance.getEntriesByType("resource");if(!e)return[];const t=[];return e.forEach((e=>{const o={name:e.name,type:e.initiatorType,duration:e.duration.toFixed(2)||0,decodedBodySize:e.decodedBodySize||0,nextHopProtocol:e.nextHopProtocol};t.push(o)})),t})(),t=(()=>{const e=r&&window.performance.getEntriesByType("navigation")[0];return e?{redirectTime:e.redirectEnd-e.redirectStart||0,appcacheTime:e.domainLookupStart-e.fetchStart||0,dnsTime:e.domainLookupEnd-e.domainLookupStart||0,tcpConnectedTime:e.connectEnd-e.connectStart||0,requestTime:e.responseEnd-e.requestStart||0,ttfbTime:e.responseStart||0,firstPaintTime:e.domInteractive||0,domRenderEndTime:e.domContentLoadedEventEnd||0,analysisTime:e.domComplete-e.domInteractive||0,onLoadTime:e.loadEventEnd||0,prepareTime:e.fetchStart||0,unloadTime:e.unloadEventEnd-e.unloadEventStart||0,firstContentPaintTime:e.domComplete||0}:{}})();this.conf.performance=t,this.conf.resourceList=e})),this.opts.isError&&(t=this.conf.errorList,window.addEventListener("error",(e=>{const o=s({msg:e.error.stack?e.error.stack.toString():e.message,data:{resourceUrl:e.target.href||e.target.src||e.target.currentSrc,line:e.lineno,col:e.colno}});e.target!==window&&t.push(o)})),window.onerror=function(e,o,n,r,i){const a=s({msg:i?.stack?i.stack.toString():e,data:{resourceUrl:o,line:n,col:r}});t.push(a)},window.addEventListener("unhandledrejection",(function(e){const o=e.reason,n=o.stack||"",r=s({msg:o.message||"",data:i(n)});t.push(r)})))}getClientData(){return S}}}));
//# sourceMappingURL=changecoder.report.min.js.map
